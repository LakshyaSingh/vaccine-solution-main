(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{pb9N:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return p})),n.d(t,"default",(function(){return l}));n("91GP"),n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("q1tI");var a=n("7ljp"),i=n("013z");n("qKvR");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var p={},r={_frontmatter:p},c=i.a;function l(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["components"]);return Object(a.b)(c,o({},r,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Development flow"),Object(a.b)("p",null," ",Object(a.b)("span",o({parentName:"p"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(a.b)("span",o({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"40.97222222222222%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnklEQVQoz02S227TQBRF/ct8Bd/AKz8APIFAKdBGqKGJiEJBrXpx2jpp0jhxfbfntjgzKWpHGtljn7PO3tuOtDFYazHGomVXveUqybmPr1lv1iilsM7hl6/TqqftehrZVdNS1x1GWdpeB0Z0ft/w+mPK0Z81s+mE4fGY03gHfS3NDUYgSluBEoZdnMUsk1vyPGN8MmEw/MbPm6swsO0V0d9Fzau3lxzMVjRFRprlSB+bUtQIpDeORhTII6pWM70u2BWaqm55SHes8px4l4oTQ6c0kZbR9XZLsliRFwW9NgJTTOcVtXJ0eh/Hf8svlz89vQqx+MgibZ6LkrRkmT5SVQXOqmC3F2ArUuUiCkw4Z48FSZJIxmlwEPLXPhpD5EGdBIuB2w0ssxcS3LMqn2Et1js53i2WfD88YnQypmk7nFcnwE4+TADO49+8G77hV/yF8c0nZneH/Lh4zyLbh+3cHqq8orwMVr2zvKwEosK9Vxcs+8KHcs1kPmB0/pXB9APHZweMLj+z2M6DSq/A/zhOQjdah0bzBDF2b9nH4+v+AUS9Y0DCMLPDAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(a.b)("img",o({parentName:"span"},{className:"gatsby-resp-image-image",alt:"1",title:"1",src:"/vaccine-solution-main/static/b488bccea3aa404fc109c922ca634085/3cbba/appsody-flow.png",srcSet:["/vaccine-solution-main/static/b488bccea3aa404fc109c922ca634085/7fc1e/appsody-flow.png 288w","/vaccine-solution-main/static/b488bccea3aa404fc109c922ca634085/a5df1/appsody-flow.png 576w","/vaccine-solution-main/static/b488bccea3aa404fc109c922ca634085/3cbba/appsody-flow.png 1152w","/vaccine-solution-main/static/b488bccea3aa404fc109c922ca634085/a5e39/appsody-flow.png 1492w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    ")),Object(a.b)("h2",null,"GitOps"),Object(a.b)("p",null,"Our Continuous Integration (CI) approach is one of ",Object(a.b)("em",{parentName:"p"},"“zero-infrastructure overhead”"),", as such Cloud Pak for application and the garage team have adopted ",Object(a.b)("a",o({parentName:"p"},{href:"https://www.gitops.tech/#what-is-gitops"}),"GitOps")," where a ",Object(a.b)("a",o({parentName:"p"},{href:"https://github.ibm.com/vaccine-cold-chain/gitops-dev"}),"specific git repository")," contains declarative descriptions of the infrastructure currently desired environments (dev, staging, production), combined with ",Object(a.b)("a",o({parentName:"p"},{href:""}),"Appsody deploy")," commands and ",Object(a.b)("a",o({parentName:"p"},{href:"#tekton-pipeline"}),"Tekton")," to automate the devops pipeline."),Object(a.b)("p",null,"Each application repository includes deployment manifests (app-deploy.yaml) to configure the application at deployment time.  "),Object(a.b)("p",null,"The ",Object(a.b)("a",o({parentName:"p"},{href:"https://github.ibm.com/vaccine-cold-chain/gitops-dev"}),"gitops-dev")," repository contains all deployment manifests of the currently desired infrastructure of an deployment environment."),Object(a.b)("p",null,"We are using a pull-based deployments, where the build pipeline is triggered by a pull requests or a commit on the application repository, and an operator, running in the solution namespace, is continuously comparing the desired state in the environment repository with the actual state in the deployed infrastructure."),Object(a.b)("h2",null,"Tekton Pipeline"),Object(a.b)("p",null,Object(a.b)("a",o({parentName:"p"},{href:"https://tekton.dev/"}),"Tekton")," is an open source project that provides a framework to create cloud-native CI/CD pipelines quickly. As a Kubernetes-native framework, Tekton makes it easier to deploy across multiple cloud providers or hybrid environments."),Object(a.b)("h3",null,"Pre-requisites"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("a",o({parentName:"p"},{href:"https://appsody.dev/docs/using-appsody/deploying/"}),"Have Appsody CLI install locally and Appsody Operator deployed to your OpenShift cluster"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("a",o({parentName:"p"},{href:""}),"Your OpenShift cluster can access the github repository where the source code resides"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("a",o({parentName:"p"},{href:""}),"Your OpenShift cluster can access a docker registry like docker hub or internal registry within the cluster"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"Defined a secret for docker registry credential: "),Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"First if not done before, create an access token to your dockerhub account, using the setting > security option."),Object(a.b)("li",{parentName:"ul"},"Then execute: ",Object(a.b)("inlineCode",{parentName:"li"},"oc create secret generic dockerhub-secret --from-literal=token=<you-created-token-on-dockerhub>")))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("a",o({parentName:"p"},{href:"https://github.com/tektoncd/cli#installing-tkn"}),"Have Tekton CLI installed")))),Object(a.b)("h3",null,"Install Tekton pipeline"),Object(a.b)("p",null,"See the ",Object(a.b)("a",o({parentName:"p"},{href:"https://github.com/tektoncd/pipeline/blob/master/docs/install.md"}),"instructions here")," which can be summarized by the following steps:"),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-shell"}),"# create dedicated pipeline project\noc new-project tekton-pipelines\n# Give access to current user and to the appsody service account.\noc adm policy add-scc-to-user anyuid -z tekton-pipelines-controller\n# install tekton\noc apply --filename https://storage.googleapis.com/tekton-releases/pipeline/latest/release.notags.yaml\n# Verify pods are started\noc get pods --namespace tekton-pipelines --watch\n\nNAME                                           READY     STATUS    RESTARTS   AGE\ntekton-pipelines-controller-6ff7d8f9bf-k7ks2   1/1       Running   0          4m\ntekton-pipelines-webhook-7986458f5f-kr78z      1/1       Running   0          4m\n# Add persistence volume\noc apply -f tektom/pv.yaml\n")),Object(a.b)("p",null,"For a given solution including multiple components deployed as pods, in the same namespace it is recommended to create a service account like the following manifest."),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-yaml"}),"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: vaccine-solution-sa\nsecrets:\n    - name: dockerhub-secret\n---  \napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: appsody-admin\nsubjects:\n- kind: ServiceAccount\n  name: vaccine-solution-sa \n  namespace: vaccine-cold-chain\nroleRef:\n  kind: ClusterRole\n  name: cluster-admin\n  apiGroup: rbac.authorization.k8s.io\n")),Object(a.b)("p",null,"One of such file is in the gitops-ev project. "),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-shell"}),"oc apply -f tekton/appsody-tekton.yaml\n")),Object(a.b)("h3",null,"Application deployment"),Object(a.b)("p",null,"Each application is built with Appsody and deployed via Appsody operator. Defined in the ",Object(a.b)("a",o({parentName:"p"},{href:"https://github.ibm.com/vaccine-cold-chain/gitops-dev/tree/master/tekton"}),"tekton directory")," of the gitops-dev project, we have a simple pipeline that will utilize the appsody deploy command to deploy the generated AppsodyApplication CRD YAML to the target environment."),Object(a.b)("p",null,"Tekton Pipelines run on the same cluster (and often in the same namespace!) as your running application code, thus allowing for more programmatic control over the deployment, management, operations, and existence of your application components. The key artifact that enables Tekton to deploy any Appsody-based microservice is the generated ",Object(a.b)("inlineCode",{parentName:"p"},"app-deploy.yaml")," file. "),Object(a.b)("p",null,"We need to define a pipeline which may look the same for each project. Still for clear separation of concern, each java projet includes a ",Object(a.b)("inlineCode",{parentName:"p"},"src/main/tekton")," folder with the needed pipeline, resources and task manifests. Here is an example of pipeline: "),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-yaml"}),"apiVersion: tekton.dev/v1alpha1\nkind: Pipeline\nmetadata:\n  name: appsody-build-pipeline\nspec:\n  resources:\n    - name: git-source\n      type: git\n    - name: docker-image\n      type: image\n  tasks:\n    - name: appsody-build\n      taskRef:\n        name: appsody-build-push-deploy-task\n      resources:\n        inputs:\n        - name: git-source\n          resource: git-source\n        - name: docker-image\n          resource: docker-image\n      params:\n      - name: app-deploy-file-name\n        value: app-deploy.yaml\n")),Object(a.b)("p",null,"and pipeline resources that define the target docker image name and the URL of the source repository, those resources are per project. See an example ",Object(a.b)("a",o({parentName:"p"},{href:""}),"here")),Object(a.b)("p",null,"The pipeline is executing a Tekton task named ",Object(a.b)("inlineCode",{parentName:"p"},"appsody-build-push-deploy-task")," and example can be found ",Object(a.b)("a",o({parentName:"p"},{href:"https://raw.githubusercontent.com/appsody/tekton-example/master/appsody-build-push-deploy.yaml"}),"here"),". "),Object(a.b)("p",null,"When ",Object(a.b)("inlineCode",{parentName:"p"},"appsody build")," is executed the deployment manifest for the application (app-deploy.yaml file) is created or updated, the deployment will use this file for the ",Object(a.b)("inlineCode",{parentName:"p"},"oc apply ")," command."),Object(a.b)("p",null,"The image url must match the definition of the Docker image resource that you created for the pipeline."),Object(a.b)("p",null,"To run the pipeline manually use the pipeline-run manifest. For example for the reefer monitorign service the manifest is under the ",Object(a.b)("inlineCode",{parentName:"p"},"scripts")," folder:"),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-shell"}),"oc apply -f scripts/reefer-monitoring-pipeline-run.yaml \n# verify the pipeline run\ntkn pipelinerun list\nNAME                                  STARTED          DURATION   STATUS\nreefer-monitoring-pipeline-run-task   31 seconds ago   ---        Running\n")),Object(a.b)("p",null,"Once the ",Object(a.b)("inlineCode",{parentName:"p"},"appsody deploy")," command is succesful, the Appsody Operator and Kubernetes takes care of the rest and reconciles the necessary underlying Kubernetes artifacts that are required to fulfill the requirements of serving up the application code in real-time!"),Object(a.b)("h2",null,"Recommended readings"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",o({parentName:"li"},{href:"https://www.gitops.tech/"}),"What is gitops")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",o({parentName:"li"},{href:"https://www.katacoda.com/ratrosyu/scenarios/playground"}),"Tekton playground on katacoda")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",o({parentName:"li"},{href:"https://github.com/appsody/tekton-example"}),"Using Tekton with Appsody example")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",o({parentName:"li"},{href:"https://www.ibm.com/cloud/blog/simplify-and-automate-deployments-using-gitops-with-ibm-multicloud-manager-3-1-2"}),"IBM Multicloud Manager is introducing GitOps support with Argo CD")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",o({parentName:"li"},{href:"https://medium.com/ibm-garage/fun-with-gitops-stitching-kubernetes-tekton-and-argo-ee348afd0b08"}),"Fun with GitOps stitching Kubernetes, Tekton, and Argo")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",o({parentName:"li"},{href:"https://www.openshift.com/learn/topics/pipelines"}),"OpenShift Pipelines - Cloud-native CI/CD"))))}l.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-devops-index-mdx-11c6a84941543527a4c7.js.map